<div class="p-5 mb-4 bg-light rounded-3">
  <div class="container-fluid py-5">
    <h1 class="display-5 fw-bold">Bem-vindo ao Repositório Acadêmico</h1>
    <p class="col-md-8 fs-4">Explore artigos e trabalhos submetidos por nossa comunidade de estudantes. Conhecimento, pesquisa e inovação em um só lugar.</p>

    <%= link_to "Ver Artigos Aprovados", '#articles_list', class: "btn btn-primary btn-lg" %>
    <%= link_to "Cadastre-se", new_user_registration_path, class: "btn btn-secondary btn-lg" %>
  </div>
</div>


<div id="articles_list">
  <h2>Artigos Recentes</h2>
  <hr class="mb-4">

  <%= form_with(url: root_path, method: :get, class: "d-flex mb-4") do |form| %>
    <%= form.text_field :query,
          class: "form-control me-2",
          placeholder: "Buscar por título...",
          value: params[:query] %>
    <%= form.submit "Buscar", class: "btn btn-outline-primary" %>
  <% end %>

<% if @approved_articles.any? %>
  <% @approved_articles.each do |article| %>
    <div class="card mb-4 shadow-sm">
      
      <%# --- LÓGICA ATUALIZADA DA IMAGEM DE CAPA --- %>
      <%# Agora, só mostramos a tag de imagem se a capa existir. Se não, nada é renderizado. %>
      <% if article.cover_image.attached? %>
        <%= image_tag article.cover_image, class: "card-img-top", style: "height: 225px; object-fit: cover;", alt: "Capa do artigo" %>
      <% end %>
      <%# --- FIM DA LÓGICA DA IMAGEM --- %>


        <div class="card-body">
          <h5 class="card-title"><%= article.title %></h5>
          <% if article.pdf_file.attached? %>
            <%= link_to "Visualizar PDF", view_pdf_article_path(article), target: "_blank", class: "btn btn-primary" %>
          <% end %>
        </div>

        <div class="card-footer text-muted">
          Publicado por <%= article.user.email %> em <%= article.updated_at.strftime("%d/%m/%Y") %>
        </div>
      </div>
    <% end %>


    <div class="d-flex justify-content-center mt-4">
      <%== pagy_bootstrap_nav(@pagy) %>
    </div>
  <% else %>
    <% if params[:query].present? %>
      <div class="alert alert-warning">
        Nenhum artigo encontrado para a busca: <strong><%= params[:query] %></strong>
      </div>
    <% else %>
      <p>Nenhum artigo foi publicado ainda. Volte em breve!</p>
    <% end %>
  <% end %>
</div>