<div class="text-center my-5">
  <h1 class="display-5 fw-bold hero-title-responsive">Bem-vindo ao Repositório Acadêmico</h1>
  <div class="col-lg-8 mx-auto">
    <p class="lead text-muted">
      Explore artigos e trabalhos submetidos por nossa comunidade de estudantes. Conhecimento, pesquisa e inovação em um só lugar.
    </p>
    <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">

      <% if user_signed_in? %>
        <% if current_user.admin? %>
          <%= link_to "Gerenciar Artigos", gerenciar_artigos_path, class: "btn btn-primary btn-lg px-4 me-sm-3" %>
        <% else %>
          <%= link_to "Enviar Novo Artigo", new_article_path, class: "btn btn-primary btn-lg px-4 me-sm-3" %>
        <% end %>
      <% else %>
        <%# Para Visitantes: Ao clicar, serão levados para o login/registo %>
        <%= link_to "Enviar Artigo", new_article_path, class: "btn btn-primary btn-lg px-4 me-sm-3" %>
      <% end %>

      <%= link_to "Ver Artigos", '#articles_list', class: "btn btn-secondary btn-lg px-4" %>
    </div>
  </div>
</div>

<div class="my-5">
  <h3><i class="bi bi-megaphone-fill"></i> Mural de Avisos</h3>
  <hr>
  <% if @notices.any? %>
    <% @notices.each do |notice| %>
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <h5 class="card-title"><%= notice.title %></h5>
          <p class="card-text"><%= notice.content %></p>
          <p class="card-text"><small class="text-muted">Publicado em <%= notice.created_at.strftime("%d/%m/%Y") %></small></p>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="text-center p-3">
      <p class="text-muted">Nenhum aviso no momento.</p>
    </div>
  <% end %>
</div>

<div id="articles_list">
  <h2>Artigos Recentes</h2>
  <hr class="mb-4">

  <%= form_with(url: root_path, method: :get, class: "d-flex mb-4") do |form| %>
    <%= form.text_field :query,
          class: "form-control me-2",
          placeholder: "Buscar por título...",
          value: params[:query] %>
    <%= form.submit "Buscar", class: "btn btn-secondary" %>
  <% end %>

<% if @approved_articles.any? %>
  <% @approved_articles.each do |article| %>
<div class="card mb-4 shadow-sm card-hover-effect">
      
      <% if article.cover_image.attached? %>
        <%= image_tag article.cover_image, class: "card-img-top", style: "height: 225px; object-fit: cover;", alt: "Capa do artigo" %>
      <% end %>

      <div class="card-body">
        <h5 class="card-title"><%= article.title %></h5>
        <% if article.pdf_file.attached? %>
            <%= link_to "Visualizar PDF", view_pdf_article_path(article), target: "_blank", class: "btn btn-secondary" %>
          <% end %>
        </div>

        <div class="card-footer text-muted">
          Publicado por <%= article.user.email %> em <%= article.updated_at.strftime("%d/%m/%Y") %>
        </div>
      </div>
    <% end %>


    <div class="d-flex justify-content-center mt-4">
      <%== pagy_bootstrap_nav(@pagy) %>
    </div>
  <% else %>
    <% if params[:query].present? %>
      <div class="alert alert-warning">
        Nenhum artigo encontrado para a busca: <strong><%= params[:query] %></strong>
      </div>
    <% else %>
      <p>Nenhum artigo foi publicado ainda. Volte em breve!</p>
    <% end %>
  <% end %>
</div>